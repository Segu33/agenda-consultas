extends layout

block content
  .container
    h2 Programación rápida de turnos

    form.filtros(method="GET", action="/programacion")
      .filtro-group
        label(for="fecha") Fecha:
        input(type="date", name="fecha", required)

        label(for="medico") Médico:
        select(name="medico")
          option(value="") Todos
          each medico in medicos
            option(value=medico.id)= medico.nombre

        label(for="especialidad") Especialidad:
        select(name="especialidad")
          option(value="") Todas
          each especialidad in especialidades
            option(value=especialidad.id)= especialidad.nombre

        label(for="sucursal") Sucursal:
        select(name="sucursal")
          option(value="") Todas
          each sucursal in sucursales
            option(value=sucursal.id)= sucursal.nombre

        button(type="submit").btn Buscar

    if horarios.length
      table.horarios
        thead
          tr
            th Hora
            th Estado
            th Acción
        tbody
          each horario in horarios
            tr
              td= horario.hora
              td
                if horario.estado == 'disponible'
                  span.estado.disponible Disponible
                else if horario.estado == 'ocupado'
                  span.estado.ocupado Ocupado
                else if horario.estado == 'sobreturno'
                  span.estado.sobreturno Sobreturno
                else
                  span.estado.bloqueado Bloqueado
              td
                if horario.estado == 'disponible'
                  form(method="POST", action=`/turnos/agendar/${horario.id}`)
                    button(type="submit").btn-agendar Agendar
                else
                  | -
        else
      p No hay horarios cargados para esta combinación.

    //- Formulario para paciente (aparece después de seleccionar un horario)
    hr
    h3 Asignar paciente al turno seleccionado

    form(method="POST", action="/turnos/confirmar")
      input(type="hidden", name="horarioId", id="horarioId")

      .form-group
        label(for="dni") DNI:
        input(type="text", name="dni", id="dni", placeholder="Ej: 30123456", required)

      .form-group
        label(for="nombre") Nombre completo:
        input(type="text", name="nombre", id="nombre", required)

      .form-group
        label(for="telefono") Teléfono:
        input(type="text", name="telefono", id="telefono")

      .form-group
        label(for="sobreturno") ¿Es sobreturno?
        input(type="checkbox", name="sobreturno", id="sobreturno")

      button.btn-confirmar(type="submit") Confirmar Turno
  script.
    document.querySelectorAll('.btn-agendar').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const horarioId = btn.closest('form').action.split('/').pop();
        document.getElementById('horarioId').value = horarioId;

        // Scroll al formulario
        window.scrollTo({
          top: document.body.scrollHeight,
          behavior: 'smooth'
        });
      });
    });
